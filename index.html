<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Photo Booth</title>
    <link rel="stylesheet" href="css/roboto.css">
    <link rel="stylesheet" href="css/main.css">
  </head>
  <body>
    <div id="countdown"></div>
    <div id="wrapper">

      <div id="top">
        <h1>Hochzeit</h1>
        <h1>Doro & Jonas</h1>
      </div>
      <div id="middle">
        <div id="imageWrapper"></div>
      </div>
      <div id="bottom">
        <button onclick="takePhoto()">Und los!</button>
      </div>

    </div>
  </body>

  <script>
    function takePhoto() {

      countdown(5);
      
    }

    function countdown(duration) {
      var count = document.getElementById("countdown");
      count.style.visibility = "visible";
      count.innerHTML = '<p>'+duration+'</p>';

      var counter = setInterval(function () {
          duration--;
          if (duration < 1) {
            count.style.visibility = "hidden";
            count.innerHTML="";
            clearInterval(counter);
          }

          if (duration == 1) {
            shoot();
          }
          count.innerHTML = '<p>'+duration+'</p>';
        }, 1000);
    }

    function shoot() {
      var PythonShell = require('python-shell');
      var pyshell = new PythonShell('./python/capture.py');

      pyshell.on('message', function (message) {
        // received a message sent from the Python script (a simple "print" statement)
        console.log(message);

        var img = document.createElement("img");
        img.src = message;

        document.getElementById("imageWrapper").appendChild(img);

      });

      // end the input stream and allow the process to exit
      pyshell.end(function (err) {
        if (err) throw err;
        console.log('finished');
      });
    }


  </script>
</html>
