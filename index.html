<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Photo Booth</title>
    <link rel="stylesheet" href="css/roboto.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/main.css">
  </head>
  <body>
    <div id="countdown"></div>
    <div class="Collage">
    </div>
    <div id="wrapper">

      <div id="top">
      </div>
      <div id="middle">
        <div id="imageWrapper"></div>
      </div>
      <div id="bottom">
        <button onclick="takePhoto()">Let's take a picture!</button>
      </div>

    </div>
  </body>

  <script>
    function takePhoto() {
      countdown(5);
    }

    function countdown(duration) {
      var count = document.getElementById("countdown");
      count.style.backogrundImage = "none";
      count.style.visibility = "visible";
      count.innerHTML = '<p>'+duration+'</p>';

      var counter = setInterval(function () {
          duration--;

           if (duration > 0) {
            count.innerHTML = '<p>'+duration+'</p>';
          }

          if (duration == 1) {
            shoot();
          }

          if (duration == 0) {
            count.innerHTML="<i class='fa fa-circle-o-notch fa-spin fa-3x fa-fw'></i>";
          }

          if (duration < -8) {
            count.style.visibility = "hidden";
            clearInterval(counter);
          }


        }, 1000);
    }

    function shoot() {

      var PythonShell = require('python-shell');
      var pyshell = new PythonShell('./python/capture.py');
      var count = document.getElementById("countdown");

      pyshell.on('message', function (message) {
        // received a message sent from the Python script (a simple "print" statement)
        count.innerHTML = "";
        console.log("Image url: "+message);
        count.style.backgroundImage = "url('"+message+"')";

      });

      // end the input stream and allow the process to exit
      pyshell.end(function (err) {
        if (err) throw err;
        console.log('finished');
      });
    }


  </script>

</html>
